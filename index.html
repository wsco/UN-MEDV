<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
    <style>

    h2{text-align:center;
       color: black;
    }

    body {
      width: 80%;
      margin-right: auto;
      margin-left: auto;
    }

    div.categories_buttons {
      position: fixed;
      top: 5px;
      left: 50px;
    }

    div.categories_buttons div {
      background-color: rgb(251, 201, 127);
      padding: 3px;
      margin: 7px;
    }

    </style>
    <script type="text/javascript">

    var pClass = false;
    var pGender = false;
    var categories = [];
      function draw(data) {
        // debugger;
        "use strict";
        d3.select('body')
          .append('h2')
          .text('Titanic Survival');

        var margin = 200,
            width = 960 - margin,
            height = 500 - margin;

        var svg = dimple.newSvg("body", width+margin, height+margin);

        var animationStates = [
                                [["Total"],false, false],
                                [["Class"], true, false],
                                [["Gender"], false, true],
                                [["Class", "Gender"],true, true]
                              ];
        var animationIdx = 0;
        var animationInterval = setInterval(function(){
          categories = animationStates[animationIdx][0];
          pClass = animationStates[animationIdx][1];
          pGender = animationStates[animationIdx][2];

          if(animationIdx>=animationStates.length){
            clearInterval(animationInterval);
          };
          update();
          animationIdx++;
        },3000);

        function update(){
          d3.selectAll("svg > *").remove();
          console.log('Chart Totals');
          var myChart = new dimple.chart(svg, data);
          myChart.width = width;
          myChart.heigth = height;
          var x = myChart.addCategoryAxis("x", categories);
          // x.addOrderRule(categories);
          x.title = "Survival ratio"+" by "+categories.join(" and ");
          var y = myChart.addPctAxis("y", "Pct");
          y.title = "Pct Passengers Survived/Deceased";

          var mySeries = myChart.addSeries(["Survived T/F"], dimple.plot.bar);
          //mySeries.aggregate = dimple.aggregateMethod.count;
          myChart.addLegend(1130, 250, 100, 100, "right");
          myChart.assignColor(false, "rgb(128, 128, 128)");
          myChart.assignColor(true, "rgb(140, 217, 140)");
          //Draw chart
          myChart.draw(500);
          // debugger;
        };
      };


      </script>
  </head>
<body>
  <script type="text/javascript">
//Use D3 to load the titanic-data file then call draw
d3.csv("titanic-data.csv", function(d){
  d['Pct']= 1;
  d['Total']='All Passengers';
  d['Gender'] = d['Sex'];
  d['Class'] = 'Class '+d['Pclass'].toString();
  d['Survived T/F']=d['Survived']==0?false:true;
  return d;
}, draw);

  </script>
</body>
</html>
